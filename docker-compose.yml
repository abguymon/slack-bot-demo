version: '3.8'

services:
  # Example service that would be deployed with different image tags
  demo-service:
    image: your-registry/demo-service:${IMAGE_TAG:-latest}
    container_name: demo-service
    ports:
      - "8080:80"
    environment:
      - SERVICE_NAME=demo-service
      - VERSION=${IMAGE_TAG:-latest}
    restart: unless-stopped
    labels:
      - "com.example.service=demo-service"
      - "com.example.version=${IMAGE_TAG:-latest}"

  # Example of how the prod K8s repo would be structured
  # This represents the repository that gets PRs created in it
  prod-k8s-repo:
    image: alpine:latest
    container_name: prod-k8s-repo
    volumes:
      - ./k8s-manifests:/k8s-manifests
    working_dir: /k8s-manifests
    command: >
      sh -c "
        echo 'ğŸ“ Prod K8s Repository Structure:' &&
        echo 'â”œâ”€â”€ deployments/' &&
        echo 'â”‚   â”œâ”€â”€ demo-service.yaml' &&
        echo 'â”‚   â””â”€â”€ other-services.yaml' &&
        echo 'â”œâ”€â”€ services/' &&
        echo 'â”‚   â””â”€â”€ demo-service-svc.yaml' &&
        echo 'â””â”€â”€ configmaps/' &&
        echo '    â””â”€â”€ demo-service-config.yaml' &&
        echo '' &&
        echo 'ğŸ’¡ When a PR is created, it would update the image tag in:' &&
        echo '   deployments/demo-service.yaml' &&
        tail -f /dev/null
      "

# Example of how to run with different image tags:
# docker-compose up -e IMAGE_TAG=v1.2.3
# docker-compose up -e IMAGE_TAG=v2.0.0 